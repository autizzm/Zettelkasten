
Theory for the cards: [[Operator HAVING - SQL]]

FILE TAGS: sql

Q: Для чего в sql нужен оператор HAVING?
A: Оператор HAVING предназначен для проверки условий. Он аналогичен WHERE, но работает для сгруппированных представлений.
	
Например, нам нужно отобразить только те результаты выборки, где `avg_price > 50`.
Наш текущий запрос:
```sql
SELECT home_type, AVG(price) as avg_price FROM Rooms
GROUP BY home_type
```
	
Результат:
	
| home_type       | avg_price |
| --------------- | --------- |
| Private room    | 89.4286   |
| Entire home/apt | 148.6667  |
| Shared room     | 40        |
<!--ID: 1757945728952-->


Q: Зачем нужен оператор HAVING, если есть ORDER BY? почему мы не можем использовать просто:
```sql
SELECT home_type, AVG(price) as avg_price FROM Rooms
GROUP BY home_type
WHERE AVG(price) > 50;
```
A: Потому что у операторов в sql есть строгий порядок выполнения. И WHERE выполняется до формирования представления -> он фильтрует отбор в представление
А оператор HAVING выполняется после того, как сформированное представление уже было сгруппировано -> он фильтрует готовое группированное представление.
В нашем примере мы пытаемся отфильтровать поля в представление, сравнивая их со средним значением по группе, хотя группы ещё не созданы. 
Однако, такой вариант вполне имеет место быть:
```sql
SELECT home_type, AVG(price) as avg_price FROM Rooms
GROUP BY home_type
WHERE price > 50; -- тут мы просто фильтруем строки перед добавлением в представление (до группировки, сортировки групп(через HAVING) и сортировки)
```
<!--ID: 1757945728962-->



Q: Что делает этот запрос? Есть ли в нем ошибки?
```sql
SELECT home_type, AVG(price) as avg_price FROM Rooms
GROUP BY home_type
HAVING avg_price > 50; 
```
A: Этот запрос группирет комнаты по их типу и выводит в представление тип и среднюю цену комнат каждой группы, чья средняя цена выше 50.
Однако, такой запрос сработал бы только в MySQL, но не в PostgreSQL, т.к. Postgres не поддерживает aliases в HAVING. 
Какого-то хуя. 
В остальных местах поддерживает. 
Така хуйня, малята.
<!--ID: 1757945728970-->
