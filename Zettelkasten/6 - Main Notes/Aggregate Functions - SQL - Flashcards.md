
Theory for the cards: [[Aggregate Functions - SQL]]]

FILE TAGS: sql

Q: Что такое агрегатная функция (в sql)?
A: Это функция, принимающая множество значений (значения определённого поля всех строк группы) и возвращающая единственное значение (которое может быть выведено в запросе с группировкой в строке соответствующей группы):
```sql
SELECT home_type, AVG(price) as avg_price FROM Rooms
GROUP BY home_type
```
Здесь среднее значение по группе будет выведено в строке соответствующей группы в поле `avg_price`
<!--ID: 1757945030603-->


Q: Как посчитать количество строк в группе при sql запросе с группировкой?
A: Использовать агрегатную функцию `COUNT(*)`. Функция `COUNT(*)` не игнорирует даже строки со значениями NULL.
<!--ID: 1757945030611-->


Q: Как посчитать среднее значение поля (`some_field`) в строках соответствующих группе при sql запросе с группировкой? Что произойдёт, если одна из строк этой таблицы бдет содержать NULL в поле `some_field`?
A: Использовать агрегатную функцию `AVG(some_field)`. Функция`AVG(some_field)` проигнорирует строки со значениями NULL.
<!--ID: 1757945030618-->


Q: Что делает этот запрос? Есть ли в нём ошибки?
```sql
SELECT home_type, COUNT(*) as amount FROM Rooms
GROUP BY home_type
ORDER BY amount DESC
```
A: Этот запрос группирует комнаты по типу, сортирует по количеству комнат в каждой группе по убыванию количества и выводит тип комнаты и количество записей с таким типом:
	
|home_type|amount|
|---|---|
|Private room|28|
|Entire home/apt|21|
|Shared room|1|
<!--ID: 1757945030627-->


Q: Что делает этот запрос? Есть ли в нём ошибки?
```sql
SELECT room_id, MAX(end_date) AS last_end_date FROM Reservations
GROUP BY room_id
```
A: Этот запрос группирует записи о резервировании комнат по id комнат, выводит id комнаты и последнюю дату регистрации из всех строк соответствующих грппе записей о резервировании комнаты с этим id:
	
|room_id|last_end_date|
|---|---|
|1|2019-02-04T12:00:00.000Z|
|2|2020-03-23T09:00:00.000Z|
|13|2020-04-21T10:00:00.000Z|
|16|2019-06-24T10:00:00.000Z|
|21|2020-02-29T10:00:00.000Z|
|19|2020-05-02T10:00:00.000Z|
|8|2020-01-21T12:00:00.000Z|
<!--ID: 1757945030635-->


Q: Применяются ли агрегатные операции в sql к полям, содержащим NULL? Или, может, применение агрегатной операции к полю, которое содержит NULL в одной из строк, вызовет ошибку?
A:  Агрегатные функции применяются только к значениям которые `IS NOT NULL`Исключение - `COUNT(*)`
<!--ID: 1757945030642-->
