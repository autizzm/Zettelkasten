
Theory for the cards: [[ACID principles - БД]]

FILE TAGS: databases

Q: Что такое ACID? Расшифруй и кратко расскажи про каждый принцип.
A:  
**A** - ***Atomicity** (атомарность)* - система не может оказаться в промежуточном состоянии (осуществляется транзакциями).
	
**C** - ***Consistency*** (постоянство) - проверка корректности добавляемых данных с помощью CONSTRAINTS (например, CHECK), FOREIGN KEY. Сейчас этим обычно занимается само приложение, т.к. это логика - а в БД просто храним. Да и в микросервисной архитектуре зачастую приходится обращаться к БД других сервисов для подтверждения валидности данных - это может выполнить только приложение.
	
**I** - ***Isolation*** (изоляция) - разграничение уровней независимости транзакций. Используем наименее низкий (они менее ресурсозатратны), в зависимости от возможных аномалий чтения в нашем случае.
	
**D** - ***Durability*** (надёжность) - сохранение данных на диск на случай падения БД (Изменения зачастую происходят в кэше. - БД сама определяет/мы задаём оптимальный способ to persist the data.)
<!--ID: 1761404248000-->


Q: Какие есть аномалии чтения данных в БД? Какие есть уровни изоляции для предотвращения их?
A:  
**Dirty Read** *(параллельный SELECT)* - второй юзер получил данные, которые мы добавили, но не закоммитили (не закончили транзакцию):
	
![[Pasted image 20251021081300.png]]
	
**Non-Repeatable Read** *(параллельный UPDATE, DELETE)* - мы начали транзакцию, запросили данные, получили. В это время кто-то поменял их UPDATE запросом (или вообще удалил -  DELETE). При повторном запросе В ХОДЕ ОДНОЙ ТРАНЗАКЦИИ мы получили другие данные:
	
![[Pasted image 20251021081610.png]]
	
**Phantom read** *(параллельный INSERT)* - чтение фантомной записи, когда кто-то добавил новую запись в ходе нашей транзакции и при новой выборке SELECT мы получаем появившуюся **фантомную** запись:
	
![[Pasted image 20251021081950.png]]
	
**Lost Update** - одновременная запись данных:
	- 1. тип (проще предотвратить) - параллельная попытка UPDATE, пока текущая транзакция на изменение данных - не завершена:
	![[Pasted image 20251021082541.png]]
	- 2. тип (сложнее предотвратить) - параллельные транзакции на получение данных, после которых, мы их изменяем, но т.к. одна из транзакций не завершена, то какая-то из них перезапишет значение:
	 ![[Pasted image 20251021082654.png]]
	
---
	
**Уровни изоляции**
	
![[Pasted image 20251021083051.png]]
	
- **Read uncommited** - разрешено читать данные, изменённые, но ещё не зафиксированные другими транзакциями.
- **Read commited** - читаются только зафиксированные изменения. - **Postgres standard**
- **Repeatable read** - все данные, прочитанные транзакцией, гарантированно не изменятся другими транзакциями до её завершения.
- **Serializable** - полная изоляция: транзакции выполняются так, как будто они идут последовательно.
<!--ID: 1761404248009-->
