
Theory for the cards:  [[Indexes - SQL]]

FILE TAGS: sql

Q: Для чего нужны индексы в sql? И как они работают?
A: У обычных таблиц нет порядка хранения дынных. Информация сохраняется в любое свободное место в файле.
	
Индексы хранятся в отдельной таблице, которая имеет определённый порядок.
В этой таблице хранится только столбец (или столбцы) используемые для поиска строк в таблице данных, вместе с информацией о том, где физически в файле находится строка.
	
> [!note] **Primary key is already indexed**
> Для PRIMARY KEY автоматически создаётся специальный индекс, который контролирует, чтобы каждое значение в колонке (или колонках), которые заданы как PRIMARY KEY, было уникальным и не было NULL. 
<!--ID: 1759599436836-->

Q: Как создать индекс для определённого столбца в уже существующей таблице (sql запросом)?
A:    
```sql
CREATE INDEX idx_email
    ON My_table (email_column);
```
<!--ID: 1759600448372-->


Q: Как удалить существующий индекс sql запросом?
A: По его названию:
```sql
DROP INDEX idx_email;
```
<!--ID: 1759600448379-->


Q: Что за параметр `UNIQUE`, который мы указываем в sql запросе при создании таблицы? Как он работает?
A: `UNIQUE` - это индекс, который при каждой вставке проверяет уникальность вставляемого значения (есть ли такое уже в этом столбце, кранимом в таблице индексов?)
	
В отличие от PRIMARY KEY - позволяет полю быть NULL (только один раз)
<!--ID: 1759600448386-->


Q: Как улучшить производительность запросов по определённому полю таблицы?
A: Сделать индекс именно для этого поля:
```sql
CREATE INDEX idx_email
    ON My_table (email_column);
```
<!--ID: 1759600448392-->


Q: Как улучшить производительность запроса по нескольким полям? Например, если мы часто ищем по полям first_name и last_name одновременно? Улучшит ли это поиск по полям first_name и last_name отдельно?
A: Можно использовать индекс на несколько колонок:
```sql
CREATE INDEX idx_full_name
    ON Student (first_name, last_name);
```
	
Однако, этот индекс не улучшит поиск по полям first_name и last_name по-отдельности. 
	
ДАЖЕ ПОРЯДОК  ПОЛЕЙ ВАЖЕН: этот индекс ускорит только такие запросы:
```sql
SELECT id, first_name, last_name
  FROM Student
  WHERE first_name LIKE 'A%' --тут проверяет сначала first_name
  AND last_name LIKE 'L%' --а потом last_name
```
	
Для ускорения  поиска по полям first_name и last_name по-отдельности нужно создать ещё по индексу на каждое из этих полей:
```sql
CREATE INDEX idx_first_name
    ON Student (first_name);
    
CREATE INDEX idx_lastt_name
    ON Student (last_name);
```
<!--ID: 1759600448399-->
